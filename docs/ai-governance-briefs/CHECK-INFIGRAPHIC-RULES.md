# インフォグラフィック生成プロセス チェック結果

## 1. ルール（cursor-prompt・設計図より）

| ルール | 内容 |
|--------|------|
| **形式** | 図は**指定フォーマット**（SVG/HTML/Table/**Mermaid**等）。**同一形式を連続して使わない**（図1・図2・図3をすべて同じ形式にしない）。 |
| **形式の多様性** | 直前に生成された**5記事**で使用された形式は、**各形式につき1回まで**。 |
| **型の多様性** | **同じ図の型（A–J）を3記事連続で使わない**。直前10記事の図表使用履歴を参照して選ぶ。 |
| **記録** | llm-out に「## 図の型」「## 図の形式」を記録する。 |

## 2. 記事1–30（手動/ブリーフ経由）

- **形式**: 各記事で **SVG, HTML, Table** を1つずつ使用（fig1_fmt, fig2_fmt, fig3_fmt がバラバラ）。
- **型**: 記事ごとに A–J の組み合わせが異なる（例: 018→D,B,G / 025→D,B,G）。
- **記録**: llm-out に「## 図の型」「## 図の形式」あり。
- **ルール**: 準拠。

## 3. 記事1–163（gen_llm_out_31_163.py で統一生成）

### 3.1 現状の実装

| 項目 | 実装 | ルール |
|------|------|--------|
| 図の形式 | **全163記事で 図1・図2・図3とも 指定フォーマット（SVG/HTML/Table/Mermaid等）**。同一形式の連続使用は禁止。 | ✅ |
| 形式の多様性 | 直近5記事で使用した形式は各形式1回まで。記事ごとに多様な組み合わせ。 | ✅ |
| 図の型 | 全163記事で **A–J をローテーション**。同じ型を3記事連続で使わない。 | ✅ |
| 図の内容 | テンプレ（T01–T32）・記事の unique_focus に沿った内容。記事ごとに作成。 | ✅ |
| 図の型/形式の記録 | llm-out に「## 図の型」「## 図の形式」**なし**。figure_usage_history のみ A,B,G / Mermaid×3 | ⚠️ 記録不備 |

### 3.2 違反まとめ

1. **形式の単調化**（過去の違反例：全記事で Mermaid のみ使用していた場合など） — 直近5記事の形式制限以前に、「SVG/HTML/Table を使う」自体が未実施。
2. **図の型の固定** — 過去の実装では A,B,G を全記事で使用していた場合あり（「3記事連続で同じ型を使わない」に反する）。現行は Cursor で記事ごとに型を選び、直前10記事の履歴を参照する。
3. **内容の重複** — テンプレ32種×3図の Mermaid のみで、視覚的に似たインフォグラフィックが多数になる。

## 4. 推奨対応 → 対応済み（2026-02-09）

1. **gen_llm_out_31_163.py の修正** ✅ 実施済み
   - 図の形式を **SVG / HTML / Table / Mermaid** 等から選び、同一形式を連続させない。1記事あたり 図1・図2・図3で形式を分ける（例：図1=SVG, 図2=HTML, 図3=Table）。
   - 図の型（A–J）を **FIG_TYPE_TRIPLETS** で20パターンローテーションし、同じ型の組み合わせが3記事連続にならないようにした。
   - 図の内容は **build_fig_svg / build_fig_html / build_fig_table** でプレースホルダー（セクション見出し・焦点を反映した簡易図）を出力。
   - 各 llm-out に「## 図の型」「## 図の形式」を出力。figure_usage_history は 1–163 を同一ロジックで出力（型ローテ・形式 SVG/HTML/Table）。
   - **テンプレ別図1**: 図1はテンプレID（T01–T32）に応じて RACI/LAYER/MATRIX/FLOW/TIMELINE/EVIDENCE_CHAIN/GATE/TOP5/KPI のいずれかのレイアウトで出力（設計図 Infographics 1番目に準拠）。

2. **統一フロー（2026-02-09）**
   - 記事1–163 の llm-out は **gen_llm_out_31_163.py** のみで生成（`python3 scripts/gen_llm_out_31_163.py`）。全記事に `apply_llm_article.py` を実行して HTML を更新。index.html は **gen_ai_governance_from_design.py** で生成（記事は上書きしない）。

3. **将来的な品質**
   - 必要に応じてブリーフ＋「直前10記事の図表使用履歴」を渡して Cursor で個別執筆すると、ルールと多様性の両方を満たしやすい。
